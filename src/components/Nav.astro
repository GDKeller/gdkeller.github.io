---
const { class: className } = Astro.props;

const navLinks = [
  { href: "#featured", label: "Work" },
  { href: "#skills", label: "Skills" },
  { href: "#jobs", label: "Experience" },
  { href: "#projects", label: "Projects" },
];
---

<nav
  id="main-nav"
  class:list={[
    "md:text-md mr-auto flex gap-2 text-sm font-semibold text-emerald-200 sm:gap-4 sm:text-sm lg:text-lg",
    className,
  ]}
>
  {
    navLinks.map(({ href, label }) => (
      <a
        href={href}
        data-section={href.slice(1)}
        class="nav-link tracking-wide transition-colors hover:text-emerald-100"
      >
        {label}
      </a>
    ))
  }
</nav>

<style>
  .nav-link {
    position: relative;
    transition:
      color 0.2s ease,
      text-shadow 0.2s ease;
  }

  .nav-link::before {
    content: "";
    position: absolute;
    left: 50%;
    top: 100%;
    transform: translateX(-50%) translateY(50%) scaleY(0%);
    width: 40px;
    height: 10px;
    background: radial-gradient(
      circle at top,
      theme("colors.emerald.300") 0%,
      theme("colors.emerald.500") 50%,
      transparent 100%
    );
    transform-origin: bottom;
    opacity: 0;
    filter: blur(6px);
    transition:
      transform 0.3s ease,
      opacity 0.2s ease;
  }

  .nav-link:hover,
  .nav-link:focus-visible {
    color: theme("colors.emerald.100");
    text-shadow: 0 0 8px theme("colors.emerald.500" / 40%);
  }

  .nav-link:hover::before,
  .nav-link:focus-visible::before {
    transform: translateX(-50%) translateY(50%) scaleY(80%);
    opacity: 1;
  }

  .nav-link.active::before {
    opacity: 0;
  }

  .nav-link::after {
    content: "";
    position: absolute;
    left: 50%;
    top: 100%;
    transform: translateX(-50%) translateY(50%) scaleY(0%);
    width: 40px;
    height: 10px;
    background: radial-gradient(
      circle at top,
      theme("colors.fuchsia.300") 0%,
      theme("colors.fuchsia.500") 50%,
      transparent 100%
    );
    transform-origin: bottom;
    opacity: 0;
    filter: blur(6px);
    transition:
      transform 0.3s ease,
      opacity 0.2s ease;
  }

  .nav-link.active {
    color: theme("colors.fuchsia.400");
    text-shadow: 0 0 12px theme("colors.fuchsia.500" / 50%);
  }

  .nav-link.active::after {
    transform: translateX(-50%) translateY(50%) scaleY(80%);
    opacity: 1;
  }

  @media (prefers-reduced-motion: reduce) {
    .nav-link,
    .nav-link::before,
    .nav-link::after {
      transition: none;
    }
  }
</style>

<script>
  const navLinks = document.querySelectorAll<HTMLAnchorElement>("#main-nav .nav-link");
  const sections = Array.from(navLinks)
    .map((link) => document.getElementById(link.dataset.section!))
    .filter(Boolean) as HTMLElement[];

  function setActiveSection() {
    const scrollY = window.scrollY;
    const viewportHeight = window.innerHeight;
    const triggerPoint = scrollY + viewportHeight * 0.3;

    let activeSection: HTMLElement | null = null;

    for (const section of sections) {
      const rect = section.getBoundingClientRect();
      const sectionTop = rect.top + scrollY;

      if (sectionTop <= triggerPoint) {
        activeSection = section;
      }
    }

    if (activeSection) {
      navLinks.forEach((l) => l.classList.remove("active"));
      const link = document.querySelector(`[data-section="${activeSection.id}"]`);
      link?.classList.add("active");
    }
  }

  // Throttle scroll handler with requestAnimationFrame
  let ticking = false;
  window.addEventListener(
    "scroll",
    () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          setActiveSection();
          ticking = false;
        });
        ticking = true;
      }
    },
    { passive: true },
  );
  setActiveSection();
</script>
